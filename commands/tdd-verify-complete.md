---
description: 验证TDD开发中测试用例的实现是否完全完成。确认所有测试通过,保证开发完成。
allowed-tools: Read, Glob, Grep, Task, Write, Edit, TodoWrite
argument-hint: [需求名称] [TASK-ID]
---
验证TDD开发中测试用例的实现是否完全完成。

# context

输出目录="./docs/implements"
功能名={{feature_name}}
任务ID={{task_id}}
需求名称={{requirement_name}}
备忘录文件=./docs/implements/{需求名称}/{{task_id}}/{feature_name}-memo.md
需求定义文件=./docs/implements/{需求名称}/{{task_id}}/{feature_name}-requirements.md
测试用例文件=./docs/implements/{需求名称}/{{task_id}}/{feature_name}-testcases.md
Refactor阶段文件=./docs/implements/{需求名称}/{{task_id}}/{feature_name}-refactor-phase.md
原任务文件=docs/tasks/{taskfile}.md

# step

- 如果没有 $ARGUMENTS,则说"请在参数中指定需求名称和TASK-ID(例: 用户认证功能 TASK-0001)"后结束
- 向用户声明 $ARGUMENTS 的内容和 context 的内容
- 执行 step2

## step2: 上下文准备

执行验证上下文的准备:

1. **确认现有的实现文档**
   - 确认 `./docs/implements/{需求名称}/{{task_id}}/` 目录内的所有MD文件
   - 优先读取以下文件:
     - `note.md` - 任务笔记(技术栈、开发规则、相关实现)
     - `{feature_name}-requirements.md` - 需求定义
     - `{feature_name}-testcases.md` - 测试用例定义
     - `{feature_name}-refactor-phase.md` - Refactor阶段的结果
     - `{feature_name}-memo.md` - 开发历史备忘录
     - 其他相关MD文件
   - 从这些文件了解现有的实现状况、设计判断、注意事项

2. **读取附加规则**
   - 如果存在 `AGENTS.md` 文件则读取
   - 如果存在 `./docs/rule` 目录则读取
   - 如果存在 `./docs/rule/tdd` 目录则读取
   - 如果存在 `./docs/rule/tdd/verify-complete` 目录则读取
   - 读取各目录内的所有文件,作为附加规则应用

3. **使用 @agent-symbol-searcher 搜索验证相关信息,并读取找到的文件**
   - 搜索计划完成的测试用例或功能,使用Read工具读取相应文件
   - 确认现有的测试覆盖率或质量标准,使用Read工具读取相关文件
   - 识别实现完成任务的标记模式,使用Read工具读取任务文件

4. **直接读取原任务文件**
   - `docs/tasks/{taskfile}.md` - 确认任务的完成状态
   - 把握项目整体的任务进度

读取完成后,执行 step3

## step3: 确认现有测试的绿色状态

- **必需**: 使用 @task 确认所有现有测试成功
- **有测试失败的情况**: 记载到memo文件,记录在后续工程修正对应
- **此工程禁止修正**: 即使发现测试失败,这里也不修正
- 记录测试状态,进入 step4

## step4: 实现状况的分析

- 确认当前的测试文件
- 计数已实现测试用例数
- 将各测试用例的内容与计划(测试用例定义文件)对照
- 以 <analysis_format> 的形式提供分析结果
- 根据质量判定标准进行合否判定
- 执行 step5

## step5: 验证结果的备忘录文件记录

- 整理・集成 {{备忘录文件}} 的现有内容,以 <memo_format> 的形式更新
- 按照**集成更新规则**,保持重要信息删除重复
- 记录实现模式、测试设计、质量保证的学习要点
- 有需要修正的项目的情况,记载后续工程的对应方针后执行 step7
- 不需要修正的情况,执行 step6

## step6: 更新原任务文件完成标记

验证完成的情况,按以下步骤自动更新原任务文件:

1. **识别完成任务**: 从原任务文件识别当前TDD开发对象任务
2. **追加完成标记**: 在相应任务追加 `✅ **完成**` 标记
3. **记载完成理由**: 追记 `(TDD开发完成 - [测试数]测试用例全通过)`
4. **更新子任务**: 在相关的子任务也追加 `[x]` 复选标记

例:

```markdown
### 1. JSON文件路径参数处理功能 ✅ **完成** (TDD开发完成 - 15测试用例全通过)

- [x] 追加用命令行参数接收JSON文件路径的功能
- [x] 对应多个JSON文件路径(sample/目录整体的读取)
- [x] 参数验证功能
```

执行 step7

## step7: TODO更新和下一步判定

- 使用 TodoWrite 工具更新 TODO 状态
  - 将当前TODO"验证阶段(完整性确认)"标记为"completed"
  - 在TODO内容中反映验证结果
  - 在TODO内容中记录质量判定结果

- **完全实现完毕判定**: 满足以下条件的情况为 完全实现完毕
  - 现有测试状态: 全部绿色
  - 需求覆盖率: 100%(全需求项目实现・测试完毕)
  - 测试成功率: 100%
  - 未实现重要需求: 0个

- **完全实现完毕的情况**: 以 <complete_output> 的形式输出,提案下一步

- **有实现不足的情况**: 以 <incomplete_output> 的形式输出,报告状况

# rules

## 验证的原则

- **此工程不进行修正**
- 此验证阶段不进行代码或测试的修正
- 发现问题的情况在memo文件中记载内容
- 修正作业委托给后续工程(下一个TDD循环或别的任务)
- 专注于验证・记录・报告
- 测试的执行使用 @task 执行

## 禁止事项(NEVER)

- 禁止修正代码或测试
- 禁止追加新实现
- 禁止删除・变更测试用例
- 禁止省略整体测试用例的实现率和成功率的报告

## 质量标准

### 最低质量标准

- **实现率**: 80%以上
- **成功率**: 100%
- **重要测试**: 全部实现
- **需求涵盖性**: 涵盖需求定义书的主要功能全部
- **编译错误**: 无

### 理想质量标准

- **实现率**: 100%
- **成功率**: 100%
- **涵盖性**: 对应全案例
- **需求完全涵盖**: 涵盖需求定义书的全项目

## 质量判定标准

```
✅ 高质量(需求充实度完全达成):
- 现有测试状态: 全部绿色
- 需求覆盖率: 100%(对需求定义书的全项目的完全实现・测试)
- 测试成功率: 100%
- 未实现重要需求: 0个
- 需求充实度: 达成对需求定义的完全充实度

⚠️ 需改进(需求充实度不足):
- 现有测试状态: 有失败测试 或
- 需求覆盖率: 100%未满(对需求定义书的项目的实现・测试不足)
- 重要的需求项目未实现・未测试
- 需求充实度: 对需求定义的充实度不充分
- 需要通过追加实现提高需求充实度
```

## 文件路径记载规则

- **使用以项目根目录为基准的相对路径**
- 不记载全路径(绝对路径)
- 例:
  - ❌ `/Users/username/projects/myapp/src/utils/helper.ts`
  - ✅ `src/utils/helper.ts`

# info

<analysis_format>
## 测试用例实现状况

### 📋 TODO.md对象任务确认
- **对象任务**: [当前TDD开发对象任务名]
- **当前状态**: [未完成/部分完成/完成]
- **完成标记要否**: [要/不要]

### 📋 计划测试用例(从需求定义)
- **总数**: [计划的总测试用例数]
- **分类**:
  - 正常系: [数]个
  - 异常系: [数]个
  - 边缘案例: [数]个
  - 其他: [数]个

### ✅ 已实现测试用例
- **总数**: [已实现总测试用例数]
- **成功率**: [通过测试数]/[实现测试数] ([成功率]%)

### ❌ 未实现测试用例([数]个)
1. **测试用例名**: [计划但未实现的测试]
   - **种类**: [正常系/异常系/边缘案例]
   - **内容**: [测试的详细内容]
   - **重要度**: [高/中/低]
   - **需求项目**: [对应的需求定义书的项目]

2. **测试用例名**: [第2个未实现测试]
   ...

### 📋 需求定义书涵盖性检查
- **需求项目总数**: [需求定义书的总项目数]
- **已实现项目**: [实现・测试完毕的项目数]
- **需求覆盖率**: [已实现]/[总数] = [覆盖率]%

#### 未涵盖的需求项目([数]个)
1. **需求项目**: [未实现的需求项目名]
   - **分类**: [输入参数/输出规格/约束条件/使用例/错误案例等]
   - **内容**: [需求的详细内容]
   - **实现不足的理由**: [为什么未实现]
   - **对应的必要性**: [必需/推荐/任意]

2. **需求项目**: [第2个未涵盖项目]
   ...

### 📊 实现率
- **整体实现率**: [实现数]/[计划数] = [实现率]%
- **正常系实现率**: [实现数]/[计划数] = [实现率]%
- **异常系实现率**: [实现数]/[计划数] = [实现率]%
- **边缘案例实现率**: [实现数]/[计划数] = [实现率]%

## 需求定义书的涵盖性检查

确认需求定义书(requirements.md)记载的以下项目是否被实现・测试:

### 必需检查项目

- **输入参数**: 全部必需・可选参数的处理
- **输出规格**: 期待的输出格式・结构的实现
- **约束条件**: 性能・安全・兼容性要求
- **基本使用例**: 假定的基本使用模式
- **边缘案例**: 边界值・例外条件的处理
- **错误案例**: 异常系的适当处理
- **主要算法**: 功能的核心处理逻辑

### 涵盖性判定标准

```
✅ 完全涵盖 (100%):
- 需求定义书的全项目被实现・测试
- 测试输入参数的全模式
- 验证输出规格的全格式
- 涵盖错误案例・边缘案例全部

⚠️ 部分涵盖 (80-99%):
- 主要功能已实现但一部分项目未实现
- 涵盖基本的使用例
- 不重要的错误案例的一部分未实现

❌ 不充分 (<80%):
- 需求定义书的重要项目未实现
- 基本的使用例有遗漏
- 错误处理不充分
```
</analysis_format>

<memo_format>
# [功能名] TDD开发完成记录

## 应确认的文档

- `docs/tasks/{任务文件路径}.md`
- `docs/implements/{需求名称}/{{task_id}}/{feature_name}-requirements.md`
- `docs/implements/{需求名称}/{{task_id}}/{feature_name}-testcases.md`

## 🎯 最终结果 ([日期时间])
- **实现率**: [数]% ([实现数]/[计划数]测试用例)
- **质量判定**: [合格/不合格]
- **TODO更新**: [✅完成标记追加/需改进]

## 💡 重要的技术学习
### 实现模式
[今后可重用的重要实现手法]

### 测试设计
[有效的测试方法]

### 质量保证
[质量确保的重要观点]

## ⚠️ 注意点・需要修正的项目(相应时)
[实现时的重要注意事项或未完成项目]

### 🔧 后续工程的修正对象
#### 测试失败
- [失败的测试用例名]
- **失败内容**: [具体的失败内容]
- **修正方针**: [推荐的修正方法]

#### 实现不足
- [未实现的功能或需求]
- **不足内容**: [具体的不足内容]
- **对应方针**: [推荐的对应方法]

#### 质量改进
- [需要质量提升的部位]
- **改进内容**: [具体的改进内容]
- **改进方针**: [推荐的改进方法]

---
*从现有备忘录内容集成重要信息,删除重复・详细的经过记录*

## 集成更新规则

1. **保持重要信息**: 集成现有备忘录的技术学习要点・可重用模式
2. **删除重复**: 类似的记录・详细的经过集约到最新信息
3. **简洁化**: 日期・数值等的详细仅保持最终结果
4. **重视重用**: 优先保留今后开发参考的信息
5. **重视相关信息**: 优先保留规格信息等的信息
</memo_format>

<complete_output>
✅ **测试用例完整性验证: 合格**

📊 此次任务需求充实度:
- 对象需求项目: [数]个
- 实现・测试完毕: [数]个 / 未实现: [数]个
- 需求覆盖率: 100%
- 需求充实度: 完全达成

📊 整体的测试状况:
- 全测试用例总数: [数]个
- 成功: [数]个 / 失败: [数]个
- 整体测试成功率: [数]%

🚀 达成了对需求定义的完全充实度。
自动进入下一个TDD循环。

推荐的下一步: 使用 `/tsumiki:tdd-cycle` 开始下一个TDD循环。
</complete_output>

<incomplete_output>
⚠️ **检测到测试用例实现不足**

📊 此次任务需求充实度:
- 对象需求项目: [数]个
- 实现・测试完毕: [数]个 / 未实现: [数]个
- 需求覆盖率: [数]%
- 需求充实度: [充实度级别]

📊 整体的测试状况:
- 全测试用例总数: [数]个
- 成功: [数]个 / 失败: [数]个
- 整体测试成功率: [数]%

❌ 未实现测试用例:
[未实现测试用例的详细列表]

📝 **修正内容已记录到memo文件**
预定在后续工程对应。此工程不进行修正。
</incomplete_output>
