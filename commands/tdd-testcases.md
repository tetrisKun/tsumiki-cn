---
description: 进行TDD开发的测试用例洗出。根据整理的需求识别全面的测试用例。
allowed-tools: Read, Glob, Grep, Task, Write, TodoWrite, Edit
argument-hint: [需求名称] [TASK-ID]
---
实施TDD开发的测试用例洗出,参照需求定义书创建全面的测试用例。显示可靠性级别定义测试用例。

# context

输出目录="./docs/implements"
功能名={{feature_name}}
任务ID={{task_id}}
需求名称={{requirement_name}}
可靠性评估=[]
需求定义文件=./docs/implements/{需求名称}/{{task_id}}/{feature_name}-requirements.md
现有测试用例文件=./docs/implements/{需求名称}/{{task_id}}/{feature_name}-testcases.md
任务文件1=./docs/tasks/{需求名称}/{{task_id}}.md
任务文件2=./docs/tasks/{需求名称}-phase*.md
任务overview文件1=./docs/tasks/{需求名称}/overview.md
任务overview文件2=./docs/tasks/{需求名称}-overview.md

# step

- 如果没有 $ARGUMENTS,则说"请在参数中指定需求名称和TASK-ID(例: 用户认证功能 TASK-0001)"后结束
- 向用户声明 $ARGUMENTS 的内容和 context 的内容
- 执行 step2

## step2

- 执行开发上下文的准备:
  **确认现有的实现文档**
  - 确认 `./docs/implements/{需求名称}/{{task_id}}/` 目录内的所有MD文件
  - 优先读取以下文件:
    - `note.md` - 任务笔记(技术栈、开发规则、相关实现)
    - `{feature_name}-requirements.md` - 现有的需求定义
    - `{feature_name}-testcases.md` - 现有的测试用例
    - `{feature_name}-memo.md` - 开发历史备忘录
    - 其他相关MD文件
  - 从这些文件了解现有的实现状况、设计判断、注意事项

  **读取任务笔记**
  - 如果不存在 `./docs/implements/{需求名称}/{{task_id}}/note.md`:
    - 使用 @task 执行 `/tsumiki:tdd-tasknote {需求名称} {{task_id}}` 命令生成笔记
    - 读取生成的笔记文件
  - 笔记包含技术栈、开发规则、相关实现、设计文档、注意事项

  **读取附加规则**
  - 如果存在 `./docs/rule` 目录则读取
  - 如果存在 `./docs/rule/tdd` 目录则读取
  - 如果存在 `./docs/rule/tdd/testcases` 目录则读取
  - 读取各目录内的所有文件,作为附加规则应用

  **使用 @agent-symbol-searcher 搜索测试相关信息,并读取找到的文件**
  - 搜索现有的测试模式或测试用例,使用Read工具读取相应测试文件
  - 识别类似功能的测试方法或模拟策略,使用Read工具读取相关文件
  - 确认测试框架的使用方法,使用Read工具读取配置文件

  **直接读取相关文件**
  - `./docs/implements/{需求名称}/{{task_id}}/{feature_name}-memo.md` - 确认现有的开发历史
  - `./docs/implements/{需求名称}/{{task_id}}/{feature_name}-requirements.md` - 确认需求定义
  - `./docs/implements/{需求名称}/{{task_id}}/{feature_name}-testcases.md` - 确认现有的测试用例
  - 根据需要读取相关的设计文档或任务文件

- 读取完成后,执行 step3

## step3

- 用 context 的信息填充 <testcases_template> 的内容,直接创建测试用例
  - 利用读取的上下文信息(任务笔记、需求定义、附加规则等)
  - 在各测试用例中记载可靠性级别(🔵🟡🔴)
  - 使用 Write 工具保存到输出文件(现有文件的情况下追加)

- 根据质量判定标准评估创建的测试用例的内容:
  - 测试用例分类: 涵盖正常系・异常系・边界值
  - 期望值定义: 各测试用例的期望值明确
  - 技术选择: 编程语言・测试框架已确定
  - 实现可能性: 当前技术栈可实现
  - 可靠性级别(🔵🟡🔴的分布)

- 向用户显示质量判定结果
- 执行 step4

## step4

- 使用 TodoWrite 工具更新 TODO 状态
  - 将当前TODO标记为"completed"
  - 在TODO内容中反映测试用例定义阶段的完成
  - 将下一阶段"Red阶段(创建失败测试)"添加到TODO
  - 在TODO内容中记录质量判定结果
- 显示下一步: "推荐的下一步: 使用 `/tsumiki:tdd-red {需求名称} {{TASK-ID}}` 开始Red阶段(创建失败测试)。"

# rules

## 文件名规则

### 输出文件的路径格式
- `docs/implements/{需求名称}/{task_id}/{feature_name}-testcases.md`
- 例: `docs/implements/user-auth/task-001/login-testcases.md`

### 文件名命名规则
- 将功能名转换为简洁的英语
- 使用短横线命名法(kebab-case)
- 控制在50个字符左右
- 例:
  - "用户认证功能" → "user-auth"
  - "数据导出功能" → "data-export"
  - "密码重置功能" → "password-reset"

## 质量判定标准

```
✅ 高质量:
- 测试用例分类: 涵盖正常系・异常系・边界值
- 期望值定义: 各测试用例的期望值明确
- 技术选择: 编程语言・测试框架已确定
- 实现可能性: 当前技术栈可实现
- 可靠性级别: 🔵(绿灯)较多

⚠️ 需改进:
- 测试用例有遗漏或重复
- 期望值模糊或不充分
- 技术选择有疑问
- 过于复杂难以实现
- 可靠性级别: 🟡🔴(黄灯、红灯)较多

❌ 不适当:
- 与需求的一致性不足
- 测试用例不足
- 技术可实现性有问题
```

## TODO更新模式

```
- 将当前TODO"测试用例洗出"标记为"completed"
- 在TODO内容中反映测试用例定义阶段的完成
- 将下一阶段"Red阶段(创建失败测试)"添加到TODO
- 在TODO内容中记录质量判定结果
```

## 可靠性级别指示

关于各测试用例,请用以下信号注释与原始资料(需求定义、现有实现、库文档等)的对照情况:

- 🔵 **绿灯**: 参考原始资料几乎没有推测的情况
- 🟡 **黄灯**: 从原始资料进行合理推测的情况
- 🔴 **红灯**: 原始资料中没有的推测情况

## 文件路径记载规则

- **使用以项目根目录为基准的相对路径**
- 不记载全路径(绝对路径)
- 例:
  - ❌ `/Users/username/projects/myapp/src/utils/helper.ts`
  - ✅ `src/utils/helper.ts`

# info

<testcases_template>
您是测试设计的负责人。请根据以下信息创建全面的测试用例。

# 测试用例创建对象的信息

功能名: {{功能名}}
任务ID: {{任务ID}}
需求名称: {{需求名称}}
输出文件名: {{输出文件名}}

# 重要的注意事项

**所有文件路径请以项目根目录为基准用相对路径记载。**
**请勿使用绝对路径(/Users/... 或 C:\... 等)。**

例:
- ❌ `/Users/username/projects/myapp/src/utils/helper.ts`
- ✅ `src/utils/helper.ts`

# 测试用例创建步骤

请利用已读取的以下上下文信息:
- **任务笔记**(`note.md`)
  - 技术栈(使用技术・框架・架构模式)
  - 开发规则(编码规范・类型检查・测试要求)
  - 相关实现(现有的实现模式・参考代码)
  - 设计文档(数据模型・目录结构)
  - 注意事项(技术限制・安全要求・性能要求)
- **需求定义书**(`{feature_name}-requirements.md`)
  - 功能的概要
  - 输入・输出的规格
  - 约束条件
  - 假定的使用例
- 附加规则(`docs/rule`, `docs/rule/tdd`, `docs/rule/tdd/testcases`)
- 现有的测试用例・测试模式

基于这些信息,请按以下格式创建测试用例。

## TDD用测试用例格式

**【可靠性级别指示】**:
关于各测试用例,请用以下信号注释与原始资料(需求定义、现有实现、库文档等)的对照情况:

- 🔵 **绿灯**: 参考原始资料几乎没有推测的情况
- 🟡 **黄灯**: 从原始资料进行合理推测的情况
- 🔴 **红灯**: 原始资料中没有的推测情况

### 1. 正常系测试用例(基本的动作)

请按以下形式记载:

- **测试名**: [易于理解的中文名]
  - **测试什么**: [此测试要确认的具体动作或功能]
  - **期待的动作**: [什么样的处理应正常执行]
- **输入值**: [具体的值]
  - **输入数据的意义**: [为什么选择这个输入值,代表什么]
- **期待的结果**: [具体的期望值]
  - **期待结果的理由**: [为什么这个结果是正确的]
- **测试的目的**: [确认什么]
  - **确认要点**: [特别要注意验证的点]
- 🔵🟡🔴 记载此测试用例的可靠性级别

### 2. 异常系测试用例(错误处理)

- **测试名**: [易于理解的中文名]
  - **错误案例的概要**: [假定什么样的异常情况]
  - **错误处理的重要性**: [为什么需要这个错误处理]
- **输入值**: [非法的值或超出边界的值]
  - **非法的理由**: [为什么这个输入值被认为是非法的]
  - **实际的发生场景**: [实际运用中什么样的场面会发生]
- **期待的结果**: [适当的错误消息或异常]
  - **错误消息的内容**: [对用户来说易于理解的消息吗]
  - **系统的安全性**: [错误时系统能保持安全状态吗]
- **测试的目的**: [错误处理的确认]
  - **质量保证的观点**: [此测试如何贡献于系统质量]
- 🔵🟡🔴 记载此测试用例的可靠性级别

### 3. 边界值测试用例(最小值、最大值、null等)

- **测试名**: [易于理解的中文名]
  - **边界值的意义**: [为什么这个值作为边界很重要]
  - **边界值的动作保证**: [确认边界附近动作的一致性]
- **输入值**: [边界值]
  - **边界值选择的依据**: [为什么选择这个值作为边界值]
  - **实际的使用场面**: [实际运用中这个边界值如何影响]
- **期待的结果**: [边界的动作]
  - **边界的正确性**: [边界值的计算或处理是否正确进行]
  - **一致的动作**: [边界的内侧和外侧动作是否一致]
- **测试的目的**: [边界条件的确认]
  - **鲁棒性的确认**: [系统在极端条件下也能稳定动作吗]
- 🔵🟡🔴 记载此测试用例的可靠性级别

### 4. 开发语言・框架

请同时指定实现使用的语言・测试框架:

- **编程语言**: {{language}}
  - **语言选择的理由**: [为什么选择这个语言]
  - **测试有利的功能**: [这个语言测试有利的特征]
- **测试框架**: {{test_framework}}
  - **框架选择的理由**: [为什么选择这个测试框架]
  - **测试执行环境**: [在什么样的环境执行测试]
- 🔵🟡🔴 记载此内容的可靠性级别

### 5. 测试用例实现时的中文注释方针

各测试用例的实现时请必须包含以下中文注释:

#### 测试用例开始时的注释

```javascript
// 【测试目的】: [用中文明确说明此测试要确认什么]
// 【测试内容】: [说明具体测试什么样的处理]
// 【期待的动作】: [说明正常动作时的结果]
// 🔵🟡🔴 记载此内容的可靠性级别
```

#### Given(准备阶段)的注释

```javascript
// 【测试数据准备】: [为什么准备这个数据的理由]
// 【初始条件设置】: [说明测试执行前的状态]
// 【前提条件确认】: [明记测试执行所需的前提条件]
```

#### When(执行阶段)的注释

```javascript
// 【实际处理执行】: [说明调用哪个功能/方法]
// 【处理内容】: [用中文说明执行的处理内容]
// 【执行时机】: [说明为什么在这个时机执行]
```

#### Then(验证阶段)的注释

```javascript
// 【结果验证】: [具体说明要验证什么]
// 【期望值确认】: [说明期望的结果及其理由]
// 【质量保证】: [说明此验证如何贡献于系统质量]
```

#### 各expect语句的注释

```javascript
// 【验证项目】: [此验证要确认的具体项目]
// 🔵🟡🔴 记载此内容的可靠性级别
expect(result.validPaths).toHaveLength(2); // 【确认内容】: 确认正确检测到2个有效路径
expect(result.invalidPaths).toContain('nonexistent.json'); // 【确认内容】: 确认不存在的文件被适当分类为无效路径
```

#### 设置・清理的注释

```javascript
beforeEach(() => {
  // 【测试前准备】: [说明各测试执行前进行的准备工作]
  // 【环境初始化】: [将测试环境恢复到干净状态的理由和方法]
});

afterEach(() => {
  // 【测试后处理】: [说明各测试执行后进行的清理工作]
  // 【状态恢复】: [为不影响下一个测试而恢复状态的理由]
});
```

### 6. 需求定义的对应关系

参照了需求定义书的情况下,请明记以下对应关系:

- **参照的功能概要**: [需求定义的相应部分]
- **参照的输入・输出规格**: [需求定义的相应部分]
- **参照的约束条件**: [需求定义的相应部分]
- **参照的使用例**: [需求定义的相应部分]

# 输出格式

请按上述格式创建测试用例。

请务必使用 Write 工具将结果保存到 {{输出文件名}}。
现有文件的情况下,请追加内容。
</testcases_template>
